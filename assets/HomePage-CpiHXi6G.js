import{k as d,n as e,r as D,N as k,L as R,s as S,v as J,M as Q,G as X,o as B,p as L,C as p,h as w,y as b,q as Y,A as Z,w as O,x as E,B as j,z as ee,D as te,E as se,H as ne,I as ae,J as oe,K as ie,O as re,Q as ce}from"./index-Bs9I9eG0.js";import{C as le,D as F,O as de,a as P,H as he,S as me,U as ue}from"./DisplayPost-Te5jShY8.js";import"./useTimeout-CpbKQOOK.js";const ge=()=>{const a=d(n=>n.posts);return e(D,{children:[e(le,{isCurrentUser:!0,className:"mw-100 m-auto p-0",style:{width:"450px"}}),a.map((n,s)=>e(F,{post:n,className:"mw-100 mx-auto my-2",style:{width:"450px"}},s))]})},pe=a=>{const n=d(s=>s.currentUser);return e(k,{className:"flex-column mt-3",id:"left-navbar",children:[e("div",{className:"navitem",children:e(k.Link,{as:R,to:a.profileLink,className:"text-dark flex-column justify-content-center",children:e(S,{user:n,size:"26",fullname:"true"})})}),e("div",{className:"navitem",children:e(k.Link,{as:R,to:"/fakebook-ainiro/friends/list",className:"text-dark",children:[e(J,{size:"26px",className:"text-info mr-2"}),e("div",{className:"d-inline",children:"Friends"})]})}),e("div",{className:"navitem",children:e(k.Link,{as:R,to:"/fakebook-ainiro/watch",className:"text-dark",children:[e(Q,{size:"26px",className:"text-info mr-2"}),e("div",{className:"d-inline",children:"Watch"})]})})]})},fe=()=>{const n=d(s=>s.posts).filter(s=>s.isYoutube);return e(D,{children:n.map((s,c)=>e(F,{post:s,className:"mw-100 mx-auto my-2",style:{width:"550px"}},c))})};function ve(a){return X({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}},{tag:"path",attr:{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}}]})(a)}const we=a=>{const{message:n,...s}=a,c=d(g=>g.user.id),l={width:"75%",backgroundColor:"dodgerblue",color:"white",padding:"16px",borderRadius:"16px"},u={width:"75%",backgroundColor:"lightgray",color:"black",padding:"16px",borderRadius:"16px"};return e(L,{...s,className:n.sender===c?"justify-content-end":"justify-content-start",children:[e("div",{style:{fontSize:"12px",margin:"auto"},children:new Date(n.timestamp).toLocaleString()}),n.isPhoto&&e("div",{className:"w-100 p-3",children:e(B,{alt:"",storagePath:n.photoURL,style:{display:"block",width:"50%",margin:"auto"}})}),e("p",{style:n.sender===c?l:u,children:n.text})]})},xe=a=>{const{conversation:n}=a;return e(p,{children:n.map((s,c)=>e(we,{message:s},c))})},Ne=a=>{const{recipient:n}=a,[s,c]=w([]),l=d(i=>i.incomingMessages),u=d(i=>i.outgoingMessages),g=l.filter(i=>i.sender===n),h=u.filter(i=>i.recipient===n);function x(i,y){return[...i,...y].sort((f,C)=>new Date(f.timestamp)-new Date(C.timestamp))}return b(()=>{const i=x(g,h);i.length!==s.length&&c(i)},[g,h,s]),e(xe,{conversation:s})},be=()=>{const[a,n]=w(!1),[s,c]=w(null),[l,u]=w(null),g=d(t=>t.currentUser),h=d(t=>t.user.id),x=d(t=>t.users),i="Aa",y={sender:`${h}`,recipient:"",text:"",isPhoto:!1,photoURL:"",isRead:!1},[r,N]=w(y);function f(t){if(!t&&s||s&&t.userID!==s.userID)return;n(!0);let o;t?o=t.userID:o="";const m={...r};m.recipient=o,N(m),c(t)}const C=Y(f,[g]);async function W(){await K(s),_(),n(!1),c(null)}function V(t){se({e:t,state:r,setState:N})}function $(t){ne({state:r,setState:N,file:t,userID:h})}function A(){ae({state:r,setState:N,user:g,userID:h})}const M=Z(null),[T,G]=w("");function U(){oe(r).then(()=>{N(y),G(M.current.scrollHeight)})}b(()=>{M.current&&(M.current.scrollTop=T)},[T]),b(()=>{O("incoming");const t=O("outgoing");return()=>t()},[]);const[v,H]=w([]),I=d(t=>t.incomingMessages).filter(t=>!t.isRead);b(()=>{const t=[];I.forEach(o=>{const m=o.sender;t.indexOf(m)===-1&&t.push(m)}),v.length!==t.length&&H(t)},[v,I]),b(()=>{if(v.length===0)return;const t=v.length-1,o=v[t];C(x.find(m=>m.userID===o))},[v,x,C]);function K(t){const o=I.filter(z=>z.sender===t.userID),m=[];return o.forEach(z=>{const{messageID:q}=z;m.push(ie(q))}),Promise.all(m)}function _(){const t=[...v];t.pop(),H(t)}return s&&a&&r.recipient===""&&f(s),e(D,{children:[e(k,{className:"flex-column",children:[e("h5",{className:"text-muted ml-3",children:e("b",{children:"Contacts"})}),x.map((t,o)=>t.userID===h?e("div",{},o):e("button",{type:"button",className:"navitem text-dark flex-row justify-content-center p-2 mb-1 nav-btn bg-200",onClick:()=>f(t),children:e(S,{size:"26",fullname:"true",bold:"false",user:t})},o))]}),e(de,{placement:"left-start",show:a,overlay:e(P,{style:{width:"350px",height:"450px",background:"white",fontSize:"1.2rem",maxHeight:`${window.innerHeight-70}px`},children:[e(P.Body,{className:"overflow-none",children:[e(P.Title,{children:[!s&&e(D,{children:[e("h6",{children:"New Message"}),e("h6",{children:"To:"})]}),s&&e(S,{size:"26",fullname:"true",bold:"true",user:s}),e("div",{className:"close-btn-container",children:e(E,{onClick:W,className:"text-primary"})})]}),e("hr",{}),s&&e(L,{className:"mh-100 overflow-auto flex-column-reverse",ref:M,children:e(Ne,{sender:h,recipient:s.userID})}),!s&&e(p,{className:"h-75 overflow-auto",children:x.map((t,o)=>t.userID===h?e("div",{},o):e("button",{type:"button",className:"flex-row text-dark justify-content-start p-2 container-choose-to nav-btn w-100 mb-1 white",onClick:()=>f(t),children:e(S,{size:"36",fullname:"true",bold:"false",user:t})},o))})]}),s&&e(P.Footer,{className:"mt-5",children:e(L,{children:[r.text===""&&e(p,{xs:2,children:e(j,{variant:"light",size:"sm",className:"add-photo-btn",onClick:()=>u(!0),children:e(he,{size:"21px",className:"text-primary"})})}),e(p,{xs:r.text===""?8:10,className:"align-self-center",style:{background:"#e9ecef",borderRadius:"18px"},children:[r.isPhoto&&e("div",{className:"comment-img-container",children:[e(B,{alt:"",storagePath:`/${r.photoURL}`,className:"img-to-comment"}),e("div",{className:"close-btn-container",children:e(E,{onClick:A})})]}),e(me,{onChange:V,onKeyPress:t=>ee(t,U),welcomeText:i,value:r.text,className:"w-100 mt-2"})]}),e(p,{xs:2,children:e(j,{variant:"light",size:"sm",className:"add-photo-btn",onClick:()=>{(r.text!==""||r.isPhoto)&&U()},children:e(te,{size:"23px",className:"text-primary"})})})]})}),e(ue,{show:l,setShow:u,updatePost:$,userID:h})]}),children:e("button",{type:"button",className:"msg-btn",onClick:()=>f(null),"aria-label":"Message",children:e(ve,{size:"22px","aria-hidden":"true"})})})]})},Pe=a=>{const{className:n}=a,s=d(g=>g.accountPage),{profileLink:c,isWatch:l}=s,u=re();return b(()=>{u(ce(l?"watch":"home"))},[l,u]),e(L,{className:`${n} overflow-hidden vh-100`,children:[e(p,{className:"mh-100 overflow-auto left-navbar-col",children:e(pe,{profileLink:c})}),e(p,{sm:9,md:l?12:9,lg:l?9:6,className:"mh-100 overflow-auto hide-scrollbar",children:[!l&&e(ge,{}),l&&e(fe,{})]}),!l&&e(p,{className:"mh-100 overflow-auto contacts-col",style:{position:"relative"},children:e(be,{})})]})};export{Pe as default};
